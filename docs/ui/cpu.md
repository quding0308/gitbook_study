
### 优化思路

#### 尽量减少主线程中的工作，放到子线程执行

iPhone的CPU目前都是多核(A10 4核，A11 6核，A12 6核)。

而主线程只能在一个核上跑，在App卡顿时，其他核往往无事可做。

一般情况下，由于主线程承担了绝大部分的工作，仅仅是把主线程的任务转移一部分给其他线程进行异步处理，就可以马上享受到并发带来的性能提升。

优化的思路之一 【尽量减少主线程中的工作，放到子线程执行】

卡顿的判断 主要是  用户与App交互时是否会卡住。例如 滑动页面时时 是否流畅，点击按钮后是否会立即有反应。

#### 多使用缓存，减少计算

#### 更新时，只更新有变化的内容 (RXDataSource的思路)

###  控件初始化 view创建消耗性能

1. 使用懒加载，创建任务分开
2. 直接使用代码创建会比storyboard创建更快
3. 尽量使用轻量的控件。例如 layer代替view

### Autolayout 性能瓶颈

自动布局是在主线程执行的。

### 图片解压

#### 图片加载

#### 图片渲染


### 文字渲染 调整对象文本计算
    
优化方案：
```
文本的宽高计算，做缓存，
    在后台线程绘制
    用 [NSAttributedString boundingRectWithSize:options:context:] 来计算文本宽高，用 -[NSAttributedString drawWithRect:options:context:] 来绘制文本，记住放到后台线程进行以避免阻塞主线程。
```

### 布局计算 调整对象层次和布局
    视图布局的计算比较消耗cpu，可以使用缓存减少计算，以及不要频繁的计算和调整


### 实际案例

#### 聊天页面 使用 RXDataSource


### 帖子页面 
#### 提前计算缓存cell的layout

#### 缓存 attributedString的渲染

#### 异步渲染layer
YYAsyncLayer

#### 滑动时 省去中间过程的计算，直接计算目标区域的cell

